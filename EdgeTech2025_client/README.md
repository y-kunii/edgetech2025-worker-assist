# Digital Twin Dashboard

工場現場向けデジタルツインデモプログラムのクライアントアプリケーション

## 概要

Digital Twin Dashboardは、工場現場のデジタルツイン状態をリアルタイムで可視化するElectronベースのデスクトップアプリケーションです。WebSocketサーバー経由でエッジ端末から送信される現場データを受信し、作業者状況、ロボット状態、ライブ映像を統合ダッシュボードで表示します。また、ロボットへの動作指示送信や作業履歴の蓄積・分析機能も提供します。

### 主な機能

- **リアルタイム状態表示**: 作業者、作業スペース、ロボットの現在状況を即座に表示
- **ライブ映像表示**: エッジ端末から送信される現場画像のリアルタイム表示
- **作業履歴管理**: 過去の作業データを蓄積し、時系列チャートで可視化
- **ロボット制御**: ダッシュボードからロボットへのマテハン指示送信
- **統計分析**: 各作業タスクの実行回数や作業効率の分析表示
- **マルチプラットフォーム対応**: Windows、macOS、Linux対応

## システム要件

### 最小要件
- **OS**: Windows 10以降 / macOS 10.15以降 / Ubuntu 18.04以降
- **メモリ**: 4GB RAM以上
- **ストレージ**: 500MB以上の空き容量
- **ネットワーク**: WebSocketサーバーへの接続環境

### 推奨要件
- **OS**: Windows 11 / macOS 12以降 / Ubuntu 20.04以降
- **メモリ**: 8GB RAM以上
- **ストレージ**: 1GB以上の空き容量
- **ディスプレイ**: 1920x1080以上の解像度

## インストール方法

### 1. 事前準備

#### 開発環境でのビルドの場合
以下のソフトウェアをインストールしてください：

- **Node.js**: バージョン18.x以降
  - [公式サイト](https://nodejs.org/)からダウンロード・インストール
- **Git**: バージョン管理システム
  - [公式サイト](https://git-scm.com/)からダウンロード・インストール

#### パッケージ版の場合
事前準備は不要です。配布されたインストーラーを使用してください。

### 2. ソースコードの取得

```bash
# リポジトリをクローン
git clone <repository-url>
cd EdgeTech2025_client

# 依存関係をインストール
npm install
```

### 3. アプリケーションのビルド

```bash
# 開発用ビルド
npm run build

# 本番用ビルド
npm run build:script
```

### 4. アプリケーションの起動

#### 開発モードで起動
```bash
npm run dev
```

#### ビルド済みアプリケーションを起動
```bash
npm start
```

## パッケージ版のインストール

### Windows
1. `Digital-Twin-Dashboard-Setup-1.0.0.exe` をダウンロード
2. インストーラーを実行し、画面の指示に従ってインストール
3. デスクトップまたはスタートメニューからアプリケーションを起動

### macOS
1. 使用するMacに応じてファイルをダウンロード：
   - Apple Silicon Mac: `Digital-Twin-Dashboard-1.0.0-arm64.dmg`
   - Intel Mac: `Digital-Twin-Dashboard-1.0.0-x64.dmg`
2. DMGファイルをマウントし、アプリケーションをApplicationsフォルダにドラッグ
3. Launchpadまたは Applicationsフォルダからアプリケーションを起動

### Linux
#### AppImage版（推奨）
```bash
# ダウンロード
wget Digital-Twin-Dashboard-1.0.0-x64.AppImage

# 実行権限を付与
chmod +x Digital-Twin-Dashboard-1.0.0-x64.AppImage

# 起動
./Digital-Twin-Dashboard-1.0.0-x64.AppImage
```

#### パッケージ版
```bash
# Debian/Ubuntu
sudo dpkg -i Digital-Twin-Dashboard-1.0.0-x64.deb

# RedHat/CentOS
sudo rpm -i Digital-Twin-Dashboard-1.0.0-x64.rpm
```

## 初期設定

### 1. WebSocketサーバー接続設定

アプリケーション初回起動時に以下の設定を行ってください：

1. **サーバーURL**: WebSocketサーバーのアドレスを入力
   - 例: `ws://localhost:9090` または `ws://192.168.1.100:9090`
2. **接続テスト**: 設定後、接続テストを実行して疎通確認
3. **自動接続**: 起動時の自動接続を有効化（推奨）

### 2. ライブ映像設定

エッジ端末からの画像ファイルを表示するための設定：

1. **画像フォルダパス**: エッジ端末が画像を保存するフォルダを指定
   - 例: `/shared/live_images` または `C:\shared\live_images`
2. **更新間隔**: 画像の自動更新間隔を設定（デフォルト: 1秒）
3. **ファイル形式**: 対応画像形式（JPG、JPEG、PNG、BMP）
4. **画像選択ロジック**: 複数の画像ファイルがある場合、**最新の更新時刻（mtime）**のファイルを自動選択

### 3. データ保存設定

履歴データの保存に関する設定：

1. **データベースファイル**: SQLiteデータベースの保存場所
2. **データ保持期間**: 履歴データの自動削除期間（デフォルト: 30日）
3. **バックアップ**: 定期バックアップの有効化

## WebSocketサーバーとのデータフォーマット

### 1. 受信データフォーマット（サーバー → クライアント）

#### ステータスデータ
```json
{
  "worker_status": "Working",
  "space_status": "Screw_tightening", 
  "robot_status": {
    "state": "ready",
    "grip": "open"
  },
  "timestamp": "20241023120000",
  "tool_delivery": 5,
  "status": "Working"
}
```

**フィールド説明:**
- `worker_status`: 作業者状況 (`"Absent"` | `"Waiting"` | `"Working"` | `"Work Completed"`)
- `space_status`: 作業スペース状況 (`"Nothing"` | `"Screw_tightening"` | `"Building_blocks"` | `"Survey_responses"`)
- `robot_status.state`: ロボット状態 (`"idle"` | `"moving"` | `"working"` | `"ready"`)
- `robot_status.grip`: グリップ状態 (`"open"` | `"closed"`)
- `timestamp`: タイムスタンプ（YYYYMMDDHHMMSS形式）
- `tool_delivery`: 工具配送回数（数値）
- `status`: 全体ステータス（worker_statusと同じ値）

### 2. 送信データフォーマット（クライアント → サーバー）

#### コマンドデータ
```json
{
  "command": "tool_handover",
  "timestamp": "20241023120000"
}
```

**コマンド種別:**
- `"tool_handover"`: 工具受け渡し
- `"tool_collection"`: 工具回収
- `"wait"`: 待機指示

### 3. 接続設定

- **プロトコル**: WebSocket (ws://)
- **デフォルトポート**: 9090
- **再接続**: 自動再接続（最大10回、1秒間隔）
- **ハートビート**: 30秒間隔

## 使用方法

### 1. ダッシュボード画面の見方

```
┌─────────────────────────────────────────────────────────────┐
│ ヘッダー: 接続状態 | 現在時刻 | デモ状況                      │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────┐ │
│ │ 作業者状況  │ │ ロボット状況│ │ ライブ映像  │ │ 制御    │ │
│ │ (イラスト)  │ │ (イラスト)  │ │             │ │ パネル  │ │
│ └─────────────┘ └─────────────┘ └─────────────┘ └─────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────┐ ┌─────────────────────────┐ │
│ │ タイムチャート              │ │ 作業統計                │ │
│ │ (作業履歴の時系列表示)      │ │ - 各作業実行回数        │ │
│ │                             │ │ - 直近作業評価          │ │
│ └─────────────────────────────┘ └─────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 2. 状態表示の読み方

#### 作業者状況
- **Absent** (不在): 作業者が作業エリアにいない状態
- **Waiting** (待機): 作業者が待機している状態
- **Working** (作業中): 作業者が作業を実行中
- **Work Completed** (作業完了): 作業が完了した状態

#### 作業スペース状況
- **Nothing** (何もなし): 作業スペースに何もない状態
- **Screw_tightening** (ネジ締め): ネジ締め作業中
- **Building_blocks** (積み木): 積み木作業中
- **Survey_responses** (アンケート): アンケート回答中

#### ロボット状況
- **state**: ロボットの動作状態（operating、idle、error等）
- **grip**: グリップの開閉状態（open、closed）

### 3. ロボット制御操作

制御パネルから以下のマテハン指示を送信できます：

- **tool_handover**: 道具の受け渡し指示
- **tool_collection**: 道具の回収指示  
- **wait**: 待機指示

### 4. 履歴データの確認

- **タイムチャート**: 過去の作業履歴を時系列で表示
- **作業統計**: 各作業タスクの実行回数と効率を表示
- **時間範囲選択**: 1時間、4時間、24時間の範囲で表示切り替え

## トラブルシューティング

### よくある問題と解決方法

#### 1. WebSocketサーバーに接続できない
**症状**: 接続状態が「切断」と表示される

**解決方法**:
- サーバーURLが正しいか確認
- サーバーが起動しているか確認
- ファイアウォール設定を確認
- ネットワーク接続を確認

#### 2. ライブ映像が表示されない
**症状**: ライブ映像エリアにプレースホルダーが表示される

**解決方法**:
- 画像フォルダパスが正しいか確認
- フォルダへのアクセス権限を確認
- エッジ端末が画像を正常に保存しているか確認

#### 3. アプリケーションが起動しない
**症状**: アプリケーションアイコンをクリックしても起動しない

**解決方法**:
- システム要件を満たしているか確認
- 管理者権限で実行を試行
- アンチウイルスソフトの除外設定を確認
- アプリケーションを再インストール

#### 4. データが保存されない
**症状**: 履歴データが表示されない

**解決方法**:
- データベースファイルの保存場所を確認
- ディスクの空き容量を確認
- アプリケーションの書き込み権限を確認

### ログファイルの確認

問題の詳細な原因を調べるには、以下のログファイルを確認してください：

- **Windows**: `%APPDATA%\Digital Twin Dashboard\logs\`
- **macOS**: `~/Library/Logs/Digital Twin Dashboard/`
- **Linux**: `~/.config/Digital Twin Dashboard/logs/`

## 開発者向け情報

### 開発環境のセットアップ

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev

# テストの実行
npm test

# リンターの実行
npm run lint
```

### ビルドコマンド

```bash
# 開発用ビルド
npm run build

# 本番用ビルド
npm run build:script

# パッケージ作成
npm run package

# 全プラットフォーム用パッケージ作成
npm run package:all

# リリース準備
npm run release
```

### プロジェクト構造

```
src/
├── main/                    # Electronメインプロセス
│   ├── main.ts             # アプリケーションエントリーポイント
│   ├── websocket-client.ts # WebSocket通信管理
│   └── file-watcher.ts     # 画像ファイル監視
├── renderer/               # Electronレンダラープロセス
│   ├── App.tsx            # メインアプリケーション
│   ├── components/        # UIコンポーネント
│   ├── hooks/            # カスタムフック
│   ├── services/         # データサービス
│   └── types/            # TypeScript型定義
└── shared/               # 共有型定義・ユーティリティ
```

## ライセンス

MIT License

## サポート

技術的な問題や質問については、以下の方法でサポートを受けることができます：

1. **GitHub Issues**: バグレポートや機能要望
2. **ドキュメント**: `docs/` フォルダ内の詳細ドキュメント
3. **開発チーム**: Digital Twin Team

## 更新履歴

### v1.0.0 (2024年)
- 初回リリース
- 基本的なダッシュボード機能
- WebSocket通信機能
- ライブ映像表示機能
- 履歴データ管理機能
- マルチプラットフォーム対応